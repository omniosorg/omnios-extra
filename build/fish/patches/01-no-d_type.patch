diff -wpruN --no-dereference '--exclude=*.orig' a~/src/wutil/dir_iter.rs a/src/wutil/dir_iter.rs
--- a~/src/wutil/dir_iter.rs	1970-01-01 00:00:00
+++ a/src/wutil/dir_iter.rs	1970-01-01 00:00:00
@@ -292,6 +292,8 @@ impl DirIter {
                 self.entry.inode = dent.d_ino;
             }
         );
+        #[cfg(not(target_os = "illumos"))]
+        {
         let typ = dirent_type_to_entry_type(dent.d_type);
         // Do not store symlinks as we will need to resolve them.
         if typ != Some(DirEntryType::Lnk) {
@@ -299,6 +301,7 @@ impl DirIter {
         }
         // This entry could be a link if it is a link or unknown.
         self.entry.possible_link = typ.map(|t| t == DirEntryType::Lnk);
+        }
 
         Some(Ok(&self.entry))
     }
